% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/as.data.frame.nicheR.R
\name{as.data.frame.nicheR}
\alias{as.data.frame.nicheR}
\title{Size aware conversion of raster stacks to data.frame for NicheR}
\usage{
as.data.frame.nicheR(
  raster_stack,
  out_filename = "NicheR_db",
  chunk_height = 500,
  keep_sql = FALSE,
  write_rdata = FALSE,
  verbose = FALSE,
  size_threshold_mb = 5000,
  use_cache = FALSE
)
}
\arguments{
\item{raster_stack}{A multi layer raster object. Supports
\code{terra::SpatRaster} or \code{raster::Raster*}. Must have valid
georeferencing so that \code{xmin}, \code{xmax}, \code{ymin}, and
row to y conversions are defined.}

\item{out_filename}{Character base name (without extension) for on disk
outputs. Files \code{<out_filename>.sqlite} and \code{<out_filename>.RData}
are written into the current working directory when the chunked workflow
is used or when \code{write_rdata = TRUE}.}

\item{chunk_height}{Positive integer. Number of raster rows per chunk to
process and append to the SQL table. Smaller values reduce memory usage
but increase the number of database writes.}

\item{keep_sql}{Logical. If \code{TRUE}, the temporary SQLite file is kept
on disk after processing. If \code{FALSE} it is deleted at the end.}

\item{write_rdata}{Logical. If \code{TRUE}, saves the resulting
\code{data.frame} as \code{<out_filename>.RData} (object name
\code{env_df}) in addition to returning it.}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages and file
paths.}

\item{size_threshold_mb}{Numeric. Estimated size in megabytes above which
the function switches from in memory conversion to the chunked SQLite
workflow.}

\item{use_cache}{Logical. If \code{TRUE} and a NicheR temporary cache file
exists in \code{tempdir()}, the function loads \code{env_df} from that
file instead of recomputing the large raster conversion. The cache is
always overwritten by the most recent large raster call.}
}
\value{
A \code{data.frame} with columns \code{x}, \code{y}, and one column
  per raster layer (matching \code{names(raster_stack)}). If
  \code{write_rdata = TRUE}, the same object is also saved as
  \code{<out_filename>.RData} (object name \code{env_df}). When the chunked
  workflow is used and \code{keep_sql = TRUE}, \code{<out_filename>.sqlite}
  is left on disk with table \code{raster_table}. Independently, the most
  recent large raster conversion is stored in a temporary cache file inside
  \code{tempdir()}.
}
\description{
Converts a raster stack to a \code{data.frame} with \code{x} and \code{y}
coordinates and one column per raster layer. For objects with an estimated
in memory size below a threshold, it wraps \code{terra::as.data.frame()}.
For larger objects, it uses a chunked SQLite workflow to avoid loading the
entire raster into memory. A single temporary cache file is used to reuse
the most recent large raster conversion within the current R session.
}
