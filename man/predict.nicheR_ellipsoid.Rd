% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict.R
\name{predict.nicheR_ellipsoid}
\alias{predict.nicheR_ellipsoid}
\title{Predict Mahalanobis distance and suitability from a nicheR ellipsoid}
\usage{
\method{predict}{nicheR_ellipsoid}(
  object,
  newdata,
  adjust_truncation_level = NULL,
  include_suitability = TRUE,
  suitability_truncated = FALSE,
  include_mahalanobis = TRUE,
  mahalanobis_truncated = FALSE,
  keep_data = NULL,
  verbose = TRUE,
  ...
)
}
\arguments{
\item{object}{A \code{nicheR_ellipsoid} object produced by
\code{\link{build_ellipsoid}}. Must contain \code{dimensions},
\code{centroid}, \code{cov_matrix}, \code{Sigma_inv}, \code{truncation_level},
and \code{var_names}.}

\item{newdata}{Environmental data to predict to. Supported inputs are:
\code{terra::SpatRaster}, \code{raster::RasterLayer},
\code{raster::RasterStack}, \code{raster::RasterBrick},
\code{data.frame}, \code{tibble}, or \code{matrix}. Predictor names must
match \code{object$var_names}.}

\item{adjust_truncation_level}{Optional numeric scalar in (0, 1). If provided,
overrides \code{object$truncation_level} for truncated outputs.}

\item{include_suitability}{Logical; if \code{TRUE}, include the
\code{"suitability"} output.}

\item{suitability_truncated}{Logical; if \code{TRUE}, include the
\code{"suitability_trunc"} output.}

\item{include_mahalanobis}{Logical; if \code{TRUE}, include the
\code{"Mahalanobis"} output.}

\item{mahalanobis_truncated}{Logical; if \code{TRUE}, include the
\code{"Mahalanobis_trunc"} output.}

\item{keep_data}{Logical or \code{NULL}. Controls whether predictor data are
  retained in the returned object.

  If \code{NULL} (default), behavior depends on the class of \code{newdata}:
  \itemize{
    \item For \code{data.frame} or \code{matrix} inputs, \code{keep_data} defaults to \code{TRUE}
          (predictor columns are retained).
    \item For \code{terra::SpatRaster} inputs, \code{keep_data} defaults to \code{FALSE}
          (only prediction layers are returned).
  }

  If explicitly set to \code{TRUE} or \code{FALSE}, that value overrides the default behavior.}

\item{verbose}{Logical; if \code{TRUE}, print progress messages.}

\item{...}{Additional arguments (currently unused).}
}
\value{
If \code{newdata} is a \code{SpatRaster}, returns a multi layer
\code{SpatRaster} with layer names matching the selected outputs
(and optionally predictor layers when \code{keep_data = TRUE}).

If \code{newdata} is a \code{data.frame} or \code{matrix}, returns a
\code{data.frame} with added columns named according to the selected outputs
(and optionally predictor columns when \code{keep_data = TRUE}).
}
\description{
Computes squared Mahalanobis distance \eqn{D^2} and a monotonic suitability
transform for new environmental data under a probabilistic ellipsoid niche.
The ellipsoid is defined by a multivariate normal (MVN) distribution with
mean vector \eqn{\mu} and inverse covariance matrix \eqn{\Sigma^{-1}} stored
in a \code{nicheR_ellipsoid} object.
}
\details{
The squared Mahalanobis distance is:
\deqn{
D^2(x) = (x - \mu)^T \Sigma^{-1} (x - \mu)
}

Suitability is computed as a monotonic transform:
\deqn{
s(x) = \exp\left(-\frac{1}{2} D^2(x)\right)
}

A point is considered inside the ellipsoid at probability level \code{cl} when:
\deqn{
D^2(x) \le \chi^2_p(\mathrm{cl})
}
where \eqn{p} is the number of predictors.

Depending on user options, the following outputs may be returned:

\itemize{
  \item \code{"Mahalanobis"}: squared Mahalanobis distance \eqn{D^2}
  \item \code{"suitability"}: \eqn{\exp(-\frac{1}{2} D^2)}
  \item \code{"Mahalanobis_trunc"}: Mahalanobis distance truncated at the
        chi square cutoff (values outside set to NA)
  \item \code{"suitability_trunc"}: suitability truncated at the chi square
        cutoff (values outside set to 0)
}

When \code{newdata} is a \code{terra::SpatRaster} (or a \code{raster::Raster*}
object coerced to \code{SpatRaster}), predictions are computed per cell and
returned as a multi layer \code{SpatRaster}. When \code{newdata} is a
\code{data.frame} or \code{matrix}, the function returns a \code{data.frame}
with added output columns using the names listed above.
}
