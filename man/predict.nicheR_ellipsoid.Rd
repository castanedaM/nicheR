% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict.R
\name{predict.nicheR_ellipsoid}
\alias{predict.nicheR_ellipsoid}
\title{Predict Mahalanobis distance and suitability from a nicheR ellipsoid}
\usage{
predict.nicheR_ellipsoid(
  object,
  newdata,
  level = 0.95,
  include_suitability = TRUE,
  suitability_truncated = FALSE,
  include_mahalanobis = TRUE,
  mahalanobis_truncated = FALSE,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{object}{A \code{nicheR_ellipsoid} object produced by
\code{\link{build_ellipsoid}}. Must contain \code{p}, \code{mu}, and
\code{Sigma_inv}.}

\item{newdata}{Environmental data to predict to. Supported inputs are:
\code{terra::SpatRaster}, \code{raster::RasterLayer},
\code{raster::RasterStack}, \code{raster::RasterBrick},
\code{data.frame}, \code{tibble}, or \code{matrix}.
For tabular inputs, if spatial columns are present they are detected using
common names (x, y, lat, lon, long, latitude, longitude) and ignored for
prediction.}

\item{level}{Numeric scalar in (0, 1]. Probability level defining the
chi-square cutoff used for truncated outputs. \code{level = 1} yields an
infinite cutoff (no truncation by probability; truncated outputs will be
identical to their non-truncated forms except for the inside/outside mask).}

\item{include_suitability}{Logical; if \code{TRUE}, include suitability
\eqn{s(x)} in the output.}

\item{suitability_truncated}{Logical; if \code{TRUE}, include a truncated
suitability layer/column where values outside the chi-square cutoff are set
to 0 (and NA values remain NA).}

\item{include_mahalanobis}{Logical; if \code{TRUE}, include squared Mahalanobis
distance \eqn{D^2} in the output.}

\item{mahalanobis_truncated}{Logical; if \code{TRUE}, include a binary inside
mask for Mahalanobis distance at \code{level}. Values are 1 for
\eqn{D^2 \le \chi^2_p(level)}, 0 otherwise (NA values remain NA).}

\item{verbose}{Logical; if \code{TRUE}, print progress messages.}

\item{...}{Additional arguments (currently unused).}
}
\value{
If \code{newdata} is a \code{terra::SpatRaster} (or a \code{raster::Raster*}
converted to \code{SpatRaster}), returns a multi-layer \code{SpatRaster}
containing the requested outputs:
\itemize{
  \item \code{mahalanobis}: squared Mahalanobis distance \eqn{D^2} (optional)
  \item \code{suitability}: \eqn{\exp(-0.5 D^2)} (optional)
  \item \code{mahalanobis_trunc}: inside mask (optional)
  \item \code{suitability_trunc}: truncated suitability (optional)
}

If \code{newdata} is a \code{data.frame} or \code{matrix}, returns a
\code{data.frame} with the same rows and added columns matching the requested
outputs. Rows with missing predictor values receive NA for numeric outputs.
}
\description{
Computes squared Mahalanobis distance \eqn{D^2} and a monotonic suitability
transform for new environmental data under a probabilistic ellipsoid niche.
The ellipsoid is defined by a multivariate normal (MVN) distribution with
mean vector \eqn{\mu} and inverse covariance matrix \eqn{\Sigma^{-1}} stored
in a \code{nicheR_ellipsoid} object.
}
\details{
The squared Mahalanobis distance is:
\deqn{
D^2(x) = (x - \mu)^T \Sigma^{-1} (x - \mu)
}

Suitability is computed as a convenient monotonic transform:
\deqn{
s(x) = \exp\left(-\frac{1}{2} D^2(x)\right)
}

A point is considered inside the ellipsoid at probability \code{level} when:
\deqn{
D^2(x) \le \chi^2_p(\text{level})
}
where \eqn{p} is the number of predictors.

When \code{newdata} is a \code{terra::SpatRaster}, computations are performed
per cell and the function returns a multi-layer \code{SpatRaster}. When
\code{newdata} is a \code{data.frame} or \code{matrix}, the function returns a
\code{data.frame} with added output columns.


This function assumes that the predictors in \code{newdata} are in the same
order and have the same meaning as used to fit \code{object}. For raster
inputs, the layers should correspond to the same predictors used to build the
ellipsoid.
}
