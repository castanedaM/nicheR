% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_bias.R
\name{prepare_bias}
\alias{prepare_bias}
\title{Prepare and Combine Sampling Bias Surfaces}
\usage{
prepare_bias(
  bias_surface,
  bias_dir = 1,
  pred = NULL,
  out_bias = c("both", "biased", "standardized"),
  verbose = TRUE,
  truncated = TRUE
)
}
\arguments{
\item{bias_surface}{A \code{terra::SpatRaster} or a list of
\code{terra::SpatRaster} objects. Multi-layer rasters are split internally
into single-layer bias surfaces.}

\item{bias_dir}{Numeric vector of \code{1} (use layer as-is) or \code{-1}
(invert via \eqn{1 - x}). A single value is recycled to match the number of
bias layers.}

\item{pred}{Optional. A \code{terra::SpatRaster} output from a prediction model
(e.g., ellipsoid suitability). Must contain 'suitability' and/or
'suitability_trunc' layers. Used as a mask/template. A log transformation
is applied, and \code{-Inf} values are converted to \code{NA} to properly
exclude truncated regions.}

\item{out_bias}{Character. Controls returned outputs:
\itemize{
  \item \code{"both"} – return both (default)
  \item \code{"biased"} – pooled bias surface only
  \item \code{"standardized"} – directional standardized layers only
}}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages.}

\item{truncated}{Logical. If \code{TRUE} (default), each bias layer is cropped
to the template extent before resampling. If \code{FALSE}, layers are only
resampled and masked.}
}
\value{
A list of class \code{"nicheR_bias_surface"} with:
\itemize{
  \item \code{pooled_bias} – pooled bias raster (if requested)
  \item \code{directional_bias} – stack of standardized and directional
  layers (if requested)
  \item \code{combination_formula} – character string showing how layers were
  combined (e.g., \code{"roads * (1-pop_density) * protected"})
}
}
\description{
Builds standardized, optionally directional, and pooled sampling bias
surfaces from one or more user-provided rasters. Bias layers are aligned to
a common template based on the `pred` layer, scaled to \eqn{[0, 1]},
optionally inverted, and combined multiplicatively to produce a pooled bias surface.
}
\details{
The function performs the following steps:
\enumerate{
  \item Split \code{bias_surface} into single-layer rasters.
  \item Prepare the template raster: If \code{pred} is provided, it subsets
  to \code{suitability} and/or \code{suitability_trunc}, applies a logarithmic
  transformation, and sets \code{-Inf} values to \code{NA}. If both layers
  are present, the first layer acts as the baseline template for scaling.
  \item Optionally crop each bias layer to the baseline extent
  (\code{truncated = TRUE}).
  \item Resample each layer to match the template grid.
  \item Standardize each layer to \eqn{[0, 1]} using min and max values.
  \item Optionally invert layers when \code{bias_dir = -1}.
  \item Stack standardized directional layers.
  \item Optionally pool layers by multiplication.
  \item Mask the final pooled and directional outputs by *each* available
  prediction layer, returning aligned bias surfaces for both
  \code{suitability} and \code{suitability_trunc} if provided.
}

Cropping and masking are done using \code{terra::crop()} and
\code{terra::mask()}. Resampling uses nearest-neighbor interpolation
(\code{method = "near"}) to preserve sharp edges common in bias layers.
}
\seealso{
\code{\link{sample_data}}
}
