% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_e_space.R
\name{plot_e_space}
\alias{plot_e_space}
\title{Plot ellipsoid niche and environments in E-space}
\usage{
plot_e_space(
  env_bg = NULL,
  x,
  y,
  z,
  labels = c("ENV 1", "ENV 2", "ENV 3"),
  n_bg = 10000,
  niche = NULL,
  suitable_env = NULL,
  occ_pts = NULL,
  rand_seed = 1234,
  show.occ.density = FALSE,
  plot.3d = FALSE,
  colors = NULL,
  palette = "default",
  vs = NULL
)
}
\arguments{
\item{env_bg}{Environmental background used to define the E-space cloud.
Can be:
\itemize{
  \item a \code{terra::SpatRaster} or \code{raster::Raster*} of predictors,
  \item a \code{data.frame} / tibble with predictor columns and optionally
        \code{x}, \code{y} coordinates.
}
If \code{NULL}, the function tries to retrieve it from \code{vs} via
\code{\link{nr_get_env}} or, if needed, approximate it from
\code{suitable_env} or the ellipsoid bounding box.}

\item{x, y, z}{Character names of the three environmental predictors to use
as axes in E-space. If omitted, they are auto-inferred from the columns of
\code{env_bg} (excluding any \code{x}/\code{y} columns), using the first
three predictor columns.}

\item{labels}{Character vector of length three giving the axis labels for
the three environmental dimensions, in the order \code{x}, \code{y},
\code{z}. Defaults to \code{c("ENV 1", "ENV 2", "ENV 3")}.}

\item{n_bg}{Integer; maximum number of background points to plot. Background
rows are randomly subsampled when \code{env_bg} is very large to avoid
overplotting and memory issues. Suitable points are also downsampled to
at most \code{n_bg / 2}.}

\item{niche}{Optional ellipsoid object of class \code{"ellipsoid"} created
by \code{\link{build_ellps}}. If provided, the function draws the niche
boundary, centroid, and tolerance (axes) in the 2D panels, and optionally
the 3D surface when \code{plot.3d = TRUE}. If \code{NULL} and \code{vs}
is supplied, it is retrieved via \code{\link{nr_get_niche}}.}

\item{suitable_env}{Optional suitable-environment object. Can be:
\itemize{
  \item the full object returned by \code{\link{get_suitable_env}},
  \item a list of rasters or a \code{SpatRaster},
  \item a \code{data.frame} of suitable points.
}
Internally, the function uses \code{\link{nr_get_suitable_df}} to obtain
a data frame of inside-ellipsoid points. If \code{NULL} and \code{vs} is
supplied, suitability is pulled from \code{vs} via \code{nr_get_suitable_df}.}

\item{occ_pts}{Optional occurrence data as a \code{data.frame} with at least
the predictor columns referenced by \code{x}, \code{y}, \code{z}.
Points are overlaid on the background and suitable environments. If
\code{NULL} and \code{vs} is supplied, occurrences are retrieved via
\code{\link{nr_get_occ}}.}

\item{rand_seed}{Integer random seed used when subsampling background and
suitable points for plotting (\code{n_bg}). Set for reproducible plots.}

\item{show.occ.density}{Logical; if \code{TRUE}, adds marginal density
plots for occurrences along each environmental axis in a 4x4 layout
(Option A). If \code{FALSE}, only the main 3x3 scatter/ellipsoid grid is
returned.}

\item{plot.3d}{Logical; if \code{TRUE}, returns an interactive 3D plotly
object showing background, suitable points, occurrences, and (optionally)
the ellipsoid surface in three dimensions. If \code{FALSE}, returns a
static ggplot-based panel layout.}

\item{colors}{Optional named list to override the default color scheme.
Recognized elements are:
\code{bg}, \code{ellipsoid}, \code{centroid}, \code{tolerance},
\code{suitable_env}, and \code{occ}. Any missing entries fall back to
the selected \code{palette}.}

\item{palette}{Character name of the built-in color palette to use.
One of:
\code{"default"}, \code{"palette2"}, \code{"palette3"},
\code{"palette4"}, \code{"palette5"}, \code{"palette6"}.}

\item{vs}{Optional object of class \code{"NicheR_species"} created by
\code{\link{create_virtual_species}}. When provided, any missing
\code{niche}, \code{suitable_env}, \code{occ_pts}, or \code{env_bg} are
retrieved via the \code{nr_get_*()} helper functions.}
}
\value{
If \code{plot.3d = FALSE}, a \code{ggpubr} object (assembled via
\code{\link[ggpubr]{ggarrange}}) containing:
\itemize{
  \item a 3x3 grid of pairwise 2D projections,
  \item optionally, a 4x4 layout with marginal densities when
        \code{show.occ.density = TRUE}.
}
If \code{plot.3d = TRUE}, an interactive \code{plotly} object is returned.
}
\description{
`plot_e_space()` visualizes an ellipsoid niche and its environments in
environmental space (E-space). It can:
\itemize{
  \item show background environments,
  \item highlight suitable environments (inside the ellipsoid),
  \item overlay occurrence points,
  \item draw 2D pairwise projections of the ellipsoid,
  \item or render a 3D interactive view of the niche and points.
}
}
\details{
The function is designed to work flexibly with:
\itemize{
  \item user-supplied objects (\code{env_bg}, \code{niche},
        \code{suitable_env}, \code{occ_pts}), or
  \item a full \code{\link{NicheR_species}} object via \code{vs}, from which
        it will automatically pull the niche, suitability, and occurrences
        using the \code{nr_get_*()} helpers.
}


Internally, the function:
\enumerate{
  \item resolves \code{env_bg} from user input or \code{vs}, coercing
        rasters to a data frame with \code{\link{as.data.frame.nicheR}},
  \item determines \code{x}, \code{y}, \code{z} from the background
        predictors (if not supplied),
  \item extracts suitable points and occurrences (if available),
  \item builds a legend that reflects which components are present,
  \item constructs either a 2D grid of ggplots or a 3D plotly view.
}

This function is intended mainly as a visualization and diagnostic tool for
ellipsoid-based niche models created with NicheR.
}
\seealso{
\code{\link{build_ellps}},
\code{\link{get_suitable_env}},
\code{\link{create_virtual_species}},
\code{\link{nr_get_env}},
\code{\link{nr_get_suitable_df}},
\code{\link{nr_get_niche}},
\code{\link{nr_get_occ}}
}
