% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/set_bias_surface.R
\name{set_bias_surface}
\alias{set_bias_surface}
\title{Construct and Combine Sampling Bias Surfaces (Optimized, nr_get-integrated)}
\usage{
set_bias_surface(
  bias_surface,
  bias_dir = 1,
  suitable_env = NULL,
  out.bias = c("biased", "standardized", "both"),
  verbose = TRUE,
  crop_to_suitable = TRUE
)
}
\arguments{
\item{bias_surface}{A \code{SpatRaster} or a list of \code{SpatRaster}
objects. Multi-layer rasters are split internally into individual
single-layer bias surfaces.}

\item{bias_dir}{Numeric vector of \code{1} (use layer as-is) or \code{-1}
(invert layer via \eqn{1 - x}). A single value is recycled to match
the number of bias layers.}

\item{suitable_env}{Optional. A suitability object, \code{NicheR_species}
object, or any structure containing a suitable environment raster.
When \code{out.bias} includes \code{"biased"}, a suitable raster is
required and is extracted automatically using \code{nr_get()}.}

\item{out.bias}{Character. Controls which bias outputs are returned:
\itemize{
  \item \code{"standardized"} – only directional standardized layers,
  \item \code{"biased"} – only the pooled bias surface,
  \item \code{"both"} – return both types of output.
}}

\item{verbose}{Logical. If \code{TRUE}, print progress information.}

\item{crop_to_suitable}{Logical. If \code{TRUE} (default), each bias layer
is cropped to match the extent of the suitable environment before
resampling. This provides substantial speed improvements.}
}
\value{
A list of class \code{nicheR_bias_surface} with elements:
\itemize{
  \item \code{pooled_bias_sp} – a single \code{SpatRaster} (if requested),
  \item \code{directional_bias_stack} – multilayer raster stack of all
         standardized + directional layers (if requested),
  \item \code{combination_formula} – a character string showing how layers
         were multiplied, e.g. \code{"roads * (1-pop_density) * protected"}.
}
}
\description{
This function ingests one or more user-provided bias layers and produces
standardized, optionally directional, and pooled sampling-bias surfaces.
It is designed for use within the NicheR virtual-species workflow and is
fully compatible with any NicheR object structure through the internal
accessor helper \code{nr_get()}.
}
\details{
The function performs several optimized steps:
\enumerate{
  \item Crops each bias layer to the extent of the suitable environment
        (if provided) — a major performance improvement.
  \item Resamples each layer to match the resolution, extent, and grid of
        the template raster.
  \item Standardizes each raster to the \eqn{[0, 1]} range using
        \code{terra::minmax()}.
  \item Optionally inverts layers when \code{bias_dir = -1}.
  \item Combines all directional layers multiplicatively to form a pooled
        bias surface.
  \item Optionally masks outputs to the suitable environment extent.
}

This procedure produces bias surfaces suitable for passed directly to
\code{\link{get_sample_occ}}, or for standalone inspection within the
NicheR workflow.


The pooled bias raster is always masked to the suitable environment when
\code{suitable_env} is provided. Standardized layers are also masked unless
\code{crop_to_suitable = FALSE}.

All raster alignment uses \code{terra::resample()} with a nearest-neighbor
method to preserve sharp edges typical of bias layers (e.g., distances,
road networks).
}
\section{Integration with NicheR}{

Unlike older versions, this function does not try to decode nested object
structures manually. Instead, it uses \code{nr_get()} internally to extract
a template raster from any of the following:
\itemize{
  \item suitability objects returned by \code{\link{get_suitable_env}},
  \item full \code{NicheR_species} objects from
        \code{\link{create_virtual_species}},
  \item lists containing SpatRasters,
  \item direct SpatRaster input.
}
This ensures compatibility across all internal and user-facing NicheR
functions.
}

\seealso{
\code{\link{nr_get}} – universal accessor for NicheR structures
\code{\link{create_virtual_species}} – full virtual species pipeline
\code{\link{get_sample_occ}} – uses pooled bias surfaces for sampling
}
